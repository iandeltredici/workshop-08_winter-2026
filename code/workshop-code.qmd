---
title: "Workshop 8"
subtitle: "F 12pm"
author: "Ian Del Tredic"
date: "Feb 27, 2026"
format:
  html:
    toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---

[deployed htm url](https://iandeltredici.github.io/workshop-08_winter-2026/code/workshop-code.html)

In this workshop, we will answer the question: How do specific leaf area, water treatment, and species influence plant mass?  

**Specific leaf area** is a continuous variable measured in cm^2^/g.  

**Water treatment** is a categorical variable (i.e. a *factor*) with 2 levels: drought stressed (DS) and well watered (WW).  

**Species** is a categorical variable (again, a *factor*) with 7 levels.  

| Species name                 | Species code | Common name        |
|------------------------------|--------------|--------------------|
| _Encelia californica_        | ENCCAL       | Bush sunflower     |  
| _Eschscholzia californica_   | ESCCAL       | California poppy   | 
| _Penstemon centranthifolius_ | PENCEN       | Scarlet bugler     | 
| _Grindelia camporums_        | GRINCAM      | Gumweed            | 
| _Salvia leucophylla_         | SALLEU       | Purple sage        | 
| _Stipa pulchra_              | STIPUL       | Purple needlegrass | 
| _Lotus scoparius_            | LOTSCO       | Deerweed           |

# 1. Set up

```{r}
#| label: packages and data

# read in your packages here
library(tidyverse) # general use
library(here) # file organization
library(janitor) # cleaning data frames
library(readxl) # reading excel files
library(scales) # modifying axis labels
library(ggeffects) # getting model predictions
library(MuMIn) # model selection

# read in your data here
drought_exp <- read_xlsx(
  here(
    "data", "Valliere_etal_EcoApps_Data.xlsx"
  ),
  sheet = "First Harvest"
)
```

```{r}
#| label: plot colors and aesthetics

# storing colors to use for species
lotsco_col <- "#E69512"
pencen_col <- "#D6264F"
salleu_col <- "#6D397D"
enccal_col <- "#3A5565"
stipul_col <- "#3F564F"
esccal_col <- "#515481"
gricam_col <- "#6C91BD"

# storing colors to use for water treatments
ds_col <- "#A62F03"
ww_col <- "#045CB4"

# storing a ggplot theme (that will be used for all ggplots)
theme_set(theme_bw())
```


# 2. Clean data

Data source: Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019). Data from: Can we condition native plants to increase drought tolerance and improve restoration success? [Dataset]. Dryad. [https://doi.org/10.5061/dryad.v0861f7](https://doi.org/10.5061/dryad.v0861f7)

```{r}
#| label: data cleaning

# # creating new object
drought_exp_clean <- drought_exp |> 
  # clean column names
  clean_names() |> 
  # makes new columns with species name instead of species code in a new column
  # relevel gives order
  mutate(species_name = case_match(
    species,
    "ENCCAL" ~ "Encelia californica", # bush sunflower
    "ESCCAL" ~ "Eschscholzia californica", # California poppy
    "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    "GRICAM" ~ "Grindelia camporum", # Gumweed
    "SALLEU" ~ "Salvia leucophylla", # purple sage
    "STIPUL" ~ "Stipa pulchra", # purple needlegrass
    "LOTSCO" ~ "Lotus scoparius" # deerweed
  )) |> 
  # change treatment codes to full descriptions in a new column
  mutate(water_treatment = case_match(
    water,
    "WW" ~ "Well watered",
    "DS" ~ "Drought stressed"
  ))  |> 
  # change species name and treatment into factors 
  mutate(species_name = as_factor(species_name),
         species_name = fct_relevel(species_name,
                                    "Lotus scoparius",
                                    "Penstemon centranthifolius",
                                    "Salvia leucophylla",
                                    "Encelia californica",
                                    "Stipa pulchra",
                                    "Eschscholzia californica",
                                    "Grindelia camporum")) |> 
  mutate(water_treatment = as_factor(water_treatment),
         water_treatment = fct_relevel(water_treatment,
                                       "Drought stressed",
                                       "Well watered")) |> 
  # select only species name, treatment, sla and total mass columns
  select(species_name, water_treatment, sla, total_g)
```

Insert code to double check the structure of the data frame here.  
```{r}
#| label: check structure
#| message: false
# check structure
str(drought_exp_clean)
```

Insert code to display 10 random rows from the data frame here.  
```{r}
#| label: display 10 rows
#| message: false
#display 10 random rows
slice_sample(drought_exp_clean, 
             n = 10)
```


# 3. Visualizing data

## What is the relationship between SLA and plant mass?  

Make a scatterplot to visualize SLA (the predictor) on the x-axis, and total mass (the response) on the y-axis.  

Label the axes with units where appropriate.  

Add a title describing the relationship (e.g. as SLA increases, total mass ______). 

```{r}
#| label: create sla & mass scatterplot
#| message: false
ggplot(data = drought_exp_clean, #create base layer using drought_exp_clean
       aes(x= sla, #x axis is sla
           y= total_g)) + #y axis is total_g
  geom_point() + #create scatterplot
  labs(title = "As SLA increases, total mass increases", #set plot title 
       x = "Specific Leaf Area (cm\U00B2/g)", #set x axis title
       y = "Total Mass (g)") #set y axis title
```


## What are the differences in total mass between water treatments?

Make a jitterplot to visualize the differences in plant mass between water treatments.  

Label the axes with units where appropriate.  

Add a title describing the differences in (mean or median) plant mass between water treatments.

```{r}
#| label: create jitterplot between water treatments
#| message: false
ggplot(data = drought_exp_clean, #create new plot with drought_exp_clean data
       aes(x = water_treatment, #set x axis 
           y = total_g, #set y axis
           color = water_treatment)) + #color by water treatment
  geom_jitter(height = 0, #create jitter plot and restrict vertical jitter
              width = 0.3) + #allow horizontal jitter
  scale_color_manual(values = c("Well watered" = ww_col, #set color of treatments
                                "Drought stressed" = ds_col)) +
  labs(x = "Water Treatment", #set x axis title
       y = "Total Mass (g)", #set y axis title
       title = "Well watered plants show a higher mass") + #set plot title
  theme(legend.position = "none", #remove legend
        plot.title.position = "plot") #move plot title
```

## What are the differences in total mass between species?

Make a jitterplot to visualize the differences in plant mass between species.  

Label the axes with units where appropriate.  

Add a title describing the differences in (mean or median) plant mass between species.  

Bonus: order the x-axis by decreasing mean plant mass _and_ wrap the long species names using the `label_wrap()` function from the `scales` package.

```{r}
#| label: jitterplot between species
#| message: false
ggplot(data = drought_exp_clean,
       aes(x = reorder(species_name, - total_g),
           y= total_g,
           color = species_name)) +
  geom_jitter(height = 0,
              width = 0.3) +
  labs(x = "Species name",
       y = "Total mass (g)",
       title = "Plant mass differs across species") +
  scale_color_manual(values = c("Lotus scoparius" = lotsco_col,
                                    "Penstemon centranthifolius" = pencen_col,
                                    "Salvia leucophylla" = salleu_col,
                                    "Encelia californica" = enccal_col,
                                    "Stipa pulchra" = stipul_col,
                                    "Eschscholzia californica" = esccal_col,
                                    "Grindelia camporum" = gricam_col)) +
  scale_x_discrete(labels = label_wrap(10)) +
  theme(legend.position = "none") 
```









# 4. Fitting models

8 models total:

| Model number | SLA | Water treatment | Species | Predictor list              |  
|--------------|:---:|:---------------:|:-------:|:---------------------------:|  
| 0            |     |                 |         | no predictors (null model)  |
| 1            |  X  |       X         |    X    | all predictors (full model) | 
| 2            |  X  |       X         |         | SLA and water treatment     |   
| 3            |  X  |                 |    X    | SLA and species             |    
| 4            |     |       X         |    X    | water treatment and species |    
| 5            |  X  |                 |         | SLA                         |    
| 6            |     |       X         |         | water treatment             |    
| 7            |     |                 |    X    | species                     |

## Model fitting

```{r}
#| label: model fitting

# model 0: null model
model0 <- lm(total_g ~ 1,
             data = drought_exp_clean)

# model 1: all predictors
model1 <- lm(total_g ~ sla +
               water_treatment +
               species_name,
             data = drought_exp_clean)

# model 2: SLA and water treatment
model2 <- lm(total_g ~ sla +
               water_treatment,
             data = drought_exp_clean)

# model 3: SLA and species
model3 <- lm(total_g ~ sla +
               species_name,
             data = drought_exp_clean)

# model 4: water treatment and species
model4 <- lm(total_g ~water_treatment +
               species_name,
             data = drought_exp_clean)

# model 5: SLA
model5 <- lm(total_g ~ sla,
             data = drought_exp_clean)

# model 6: water treatment
model6 <- lm(total_g ~ water_treatment,
             data = drought_exp_clean)

# model 7: species
model7 <- lm(total_g ~ species_name,
             data = drought_exp_clean)
```

## Model selection

Insert code to use the `AICc()` function to calculate the AIC for each model.  

Arrange by decreasing AIC.
```{r}
#| label: AIC model selection
#| message: false
AICc(model0,
    model1,
    model2,
    model3,
    model4,
    model5,
    model6,
    model7) |> 
  arrange(AICc)
```
Best model is model4: includes only water treatment and species name.
## Model diagnostics

Insert code to look at the diagnostic plots for the best model.
```{r}
#| label: residual plot for model4
par(mfrow = c(2,2)) #display plots in 2 x 2 grid
plot(model4)
```
Diagnostic plots look good.
Residuals look normally distributed based on QQ plot.
Residuals appear homoscedastic (constant variance) based on Residuals vs Fitted plot and Scale-Location plot.
NO outliers influencing model estimates of coefficients.



## Summary

Insert code to display the summary for the best model. 
```{r}
summary(model4)
```


**What are the reference levels?**  
Drought stressed treatment and Lotus scoparius because they are not listed in the summary output.

**What does the `(Intercept)` represent?**  
estimated mass for drought stressed lotus scoparius (0.055g)

**What does `water_treatmentWell watered` represent?**
This is the model prediction for the difference in Lotus scoparious mass between the well watered and drought stressed treatments. The model predicts the difference is 0.12 +/- 0.02 (SE) g.

**What does `species_namePenstemon centranthifolius` represent?**  
This is the model prediction for the difference between Penstemon centranthisfolius mass in the well watered treatment and Lotus scoparious mass in the well watered treatment. The model predicts a difference of 0.05 +/- 0.03 (SE) g. 

**What does `species_nameEschscholzia californica` represent?**
This is the model prediction between Eschscholzia californica mass in the well watered treatment and Lotus scoparious mass in the well watered treatment. The model predicts a difference of 0.23 +/- 0.03 (SE) g.


## Stop and think: what does this model mean?  

**What is the best model?**

The best model includes species name and water treatment as predictors.

**How much variation in the response (total mass, in grams) does this model explain?**

This model explains 72.57% of the variation in total mass (g).

**How do we interpret the effects of the predictors on the response variable (again, total mass in grams)?**

Water treatment influence plant mass.
Species influences plant mass.

# 4. Model predictions

Insert code to generate model predictions for the best model.  

Rename the `x` column and `group` column to match the original data frame (`drought_exp_clean`).

Look at the object before plotting.



# 5. Final figure

Create a clean, publication ready figure depicting predictions for the best model and the underlying data.


# 6. Writing

## Figure caption








## Basic components of test

**predictors**  


**response**  


**test**  


**distribution**  


**parameters (degrees of freedom)**  


**test statistic**


**R^2^**  


**p-value**   


**significance level**  


**reference level(s)**  


## Written communication

### Methods

#### Goal of analysis


#### Model selection


#### Model diagnostics


### Results









